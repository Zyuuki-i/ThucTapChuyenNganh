@model IEnumerable<WebApp_BanNhacCu.Areas.Admin.MyModels.CHinh>

@{
    ViewData["Title"] = "chinhSuaAnh";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}


@{
    SanPham sp = ViewBag.SP;
}
<h1 class="mt-5 text-center text-uppercase fw-bold">@(sp!=null?@sp.Tensp:"Hình Sản phẩm")</h1>
<div class="d-flex justify-content-center mb-5">
    <a class="btn btn-info " asp-area="Admin" asp-controller="SanPham" asp-action="chiTietSP" asp-route-id="@(sp != null ? @sp.MaSp : "SP01")">Quay lại</a>
</div>
@if (TempData["MessageError_Anh"] != null)
{
    <div class="alert alert-danger text-center fw-bold">
        @TempData["MessageError_Anh"]
    </div>
}
<hr />
@if (sp != null)
{
    <div class="mb-5">
        <form asp-area="Admin" asp-controller="SanPham" asp-action="themAnh" method="post" enctype="multipart/form-data">
            <div class="row">
                <div class="form-group col-sm-4">
                    <input type="hidden" name="maSp" value="@sp.MaSp" />
                    <input type="file" name="filehinh" class="form-control" multiple />
                </div>
                <div class="form-group col-sm-1 d-flex justify-content-center align-items-center text-center">
                    <input type="submit" value="Thêm" class="btn btn-info" />
                </div>
                <div class="col-sm-7"></div>
            </div>
        </form>
    </div>
}
@if(Model.Count() > 0){
<div class="container-fluid bg-light p-3 rounded-3">
    <div class="row flex-row flex-wrap justify-content-evenly align-items-center">
        <div class="col-sm-6 row justify-content-evenly align-items-center">
            @foreach (var item in Model)
            {
                <div class="col-sm-2 me-2">
                    <button type="button" class="btn-select bg-transparent p-0 border-0" 
                            data-mahinh="@item.MaHinh"
                            data-masp="@item.MaSp"
                            data-url="@item.Url">
                        @{
                            string url = "~/images/anhsp/" + item.MaSp.Trim() + "/" + item.Url;
                            <img src="@Url.Content(url)" alt="@item.MaSp" width="120" height="120" />
                        }
                    </button>
                </div>
            }
        </div>
        <div class="col-sm-6 p-3">
            <table class="table border" style="height:200px">
                <thead>
                    <tr>
                        <td>@Html.DisplayNameFor(model => model.MaHinh)</td>
                        <td>@Html.DisplayNameFor(model => model.MaSp)</td>
                        <td>@Html.DisplayNameFor(model => model.Url)</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="mahinh"></td>
                        <td id="masp"></td>
                        <td id="url"></td>
                    </tr>
                </tbody>
            </table>
            <div class="d-flex justify-content-end align-items-center text-center">
                <a id="btnXoa" class="btn btn-danger" asp-area="Admin" asp-controller="SanPham" asp-action="xoaAnh" asp-route-id="">Xóa</a>
            </div>
        </div>
        @section Scripts {
            <script>
                const btnXoa = document.getElementById('btnXoa');
                let mahinhDangChon = null;

                document.querySelectorAll('.btn-select').forEach(btn => {
                    btn.addEventListener('click', () => {

                        document.getElementById('mahinh').textContent = btn.dataset.mahinh;
                        document.getElementById('masp').textContent = btn.dataset.masp;
                        document.getElementById('url').textContent = btn.dataset.url;

                        document.querySelectorAll('.btn-select img').forEach(img => img.classList.remove('selected-img'));
                        btn.querySelector('img').classList.add('selected-img');

                        mahinhDangChon = btn.dataset.mahinh;
                        btnXoa.href = `/Admin/SanPham/xoaAnh/${mahinhDangChon}`;
                        btnXoa.classList.remove('disabled');
                    });
                });
                btnXoa.addEventListener('click', (e) => {
                    if (!mahinhDangChon) {
                        e.preventDefault();
                        alert("Vui lòng chọn ảnh trước khi xóa!");
                        return;
                    }
                    if (!confirm("Bạn có chắc muốn xóa ảnh này không?")) {
                        e.preventDefault();
                    }
                });
            </script>

            <style>
                .selected-img {
                    border: 3px solid gray;
                    transform: scale(0.95);
                    opacity: 0.8;
                    transition: 0.2s;
                }
            </style>
        }
    </div>
</div>
}
<script>
     document.addEventListener("DOMContentLoaded", function () {
         const alertBox = document.querySelector(".alert");
         if (alertBox) {
             setTimeout(() => alertBox.style.display = "none", 3000);
         }
     });
</script>
