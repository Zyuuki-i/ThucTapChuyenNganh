@model IEnumerable<WebApp_BanNhacCu.Models.ChiTietDonDatHang>

@{
    ViewData["Title"] = "Giỏ hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Giỏ hàng của bạn</h1>
<hr/>
@if (!Model.Any())
{
    <p>Giỏ hàng của bạn đang trống.</p>
}
else
{
    <div class="row">
        <div class="col-sm-8">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Hình</th>
                        <th>Sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        List <Hinh> dsHinh = ViewBag.DsHinh;
                    }
                    @foreach (var item in Model)
                    {
                        string tenfile = "";
                        @foreach (Hinh hinh in dsHinh)
                        {
                            if (hinh.MaSp == item.MaSp)
                            {
                                tenfile = hinh.Url;
                                break;
                            }
                        }
                        string url = "";
                        if (tenfile == "")
                        {
                            url = "~/images/anhsp/default.png";
                        }
                        else
                        {
                            url = "~/images/anhsp/" + item.MaSp.Trim() + "/" + tenfile;
                        }
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="@Url.Content(url)" alt="@item.MaSpNavigation.Tensp" class="rounded-3 me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                </div>
                            </td>
                            <td>@item.MaSpNavigation.Tensp</td>
                            <td>@item.Soluong</td>
                            <td>@String.Format("{0:N0}",item.Gia)đ</td>
                            <td>@String.Format("{0:N0}",(item.Soluong * item.Gia))đ</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col-sm-4">
            <h3>Thông tin đơn hàng</h3>
            <hr/>
            <div class="d-flex flex-row justify-content-between mb-3">
                <strong>Số sản phẩm:</strong>
                <span class="text-danger">@Model.Sum(i => i.Soluong)</span>
            </div>
            <div class="d-flex flex-row justify-content-between mb-3">
                <strong>Tổng tiền:</strong>
                <span class="text-danger fs-5">@String.Format("{0:N0}", @Model.Sum(i => i.Soluong * i.Gia))đ</span>
            </div>
            <div>
                <p class="form-control text-secondary fs-6 mb-4" readonly>Nhấn "Thanh toán" đồng nghĩa với việc bạn đồng ý tuân theo <a class="text-decoration-none text-danger" asp-controller="Home" asp-action="Privacy">Điều khoản & Chính sách</a> của đơn vị</p>
            </div>
            <form asp-controller="DonDatHang" asp-action="thanhToan" method="post">
                <button class="btn btn-outline-success w-100" type="submit">Thanh toán</button>
            </form>
        </div>
    </div>
}
